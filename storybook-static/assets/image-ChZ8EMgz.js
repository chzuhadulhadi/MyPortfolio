import{r as m}from"./index-CBqU2yxZ.js";function p(r,n,s={},o=!0){const[c,t]=m.useState(!1),[e,a]=m.useState(!1);return m.useEffect(()=>{if(!(r!=null&&r.current))return;const i=new IntersectionObserver(([d])=>{const{isIntersecting:u,target:f}=d;t(u),u&&n&&(i.unobserve(f),a(!0))},s);return!e&&o&&i.observe(r.current),()=>i.disconnect()},[r,n,s,e,o]),c}async function l({src:r,srcSet:n,sizes:s}){return new Promise((o,c)=>{try{if(!r&&!n)throw new Error("No image src or srcSet provided");let t=new Image;r&&(t.src=r),n&&(t.srcset=n),s&&(t.sizes=s);const e=()=>{t.removeEventListener("load",e);const a=t.currentSrc;t=null,o(a)};t.addEventListener("load",e)}catch(t){c(`Error loading ${n}: ${t}`)}})}async function g(r=1,n=1){return new Promise(s=>{const o=document.createElement("canvas"),c=o.getContext("2d");o.width=r,o.height=n,c.fillStyle="rgba(0, 0, 0, 0)",c.fillRect(0,0,r,n),o.toBlob(async t=>{if(!t)throw new Error("Video thumbnail failed to load");const e=URL.createObjectURL(t);o.remove(),s(e)})})}async function v({srcSet:r,sizes:n}){const s=await Promise.all(r.split(", ").map(async e=>{const[a,i]=e.split(" "),d=Number(i.replace("w","")),u=await g(d);return{src:a,image:u,width:i}})),o=s.map(({image:e,width:a})=>`${e} ${a}`).join(", "),c=await l({srcSet:o,sizes:n});return s.find(e=>e.image===c).src}export{v as r,p as u};

class p{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const s=this.order.indexOf(e);s!==-1&&(this.order.splice(s,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function w(d){let e=new p,s=new p,a=0,r=!1,c=!1;const f=new WeakSet,l={schedule:(n,i=!1,u=!1)=>{const t=u&&r,o=t?e:s;return i&&f.add(n),o.add(n)&&t&&r&&(a=e.order.length),n},cancel:n=>{s.remove(n),f.delete(n)},process:n=>{if(r){c=!0;return}if(r=!0,[e,s]=[s,e],s.clear(),a=e.order.length,a)for(let i=0;i<a;i++){const u=e.order[i];f.has(u)&&(l.schedule(u),d()),u(n)}r=!1,c&&(c=!1,l.process(n))}};return l}const h=["prepare","read","update","preRender","render","postRender"],P=40;function R(d,e){let s=!1,a=!0;const r={delta:0,timestamp:0,isProcessing:!1},c=h.reduce((t,o)=>(t[o]=w(()=>s=!0),t),{}),f=t=>{c[t].process(r)},l=()=>{const t=performance.now();s=!1,r.delta=a?1e3/60:Math.max(Math.min(t-r.timestamp,P),1),r.timestamp=t,r.isProcessing=!0,h.forEach(f),r.isProcessing=!1,s&&e&&(a=!1,d(l))},n=()=>{s=!0,a=!0,r.isProcessing||d(l)};return{schedule:h.reduce((t,o)=>{const m=c[o];return t[o]=(g,F=!1,x=!1)=>(s||n(),m.schedule(g,F,x)),t},{}),cancel:t=>h.forEach(o=>c[o].cancel(t)),state:r,steps:c}}const E=d=>d,{schedule:S,cancel:q,state:v,steps:A}=R(typeof requestAnimationFrame<"u"?requestAnimationFrame:E,!0);export{S as a,q as c,v as f,E as n};
